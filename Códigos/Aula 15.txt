TRIGGER(GATILHOS/GATINHOS)
Progama PL/SQL armazenado no banco de dados que é disparado a partir da
ocorrência de um evento

Criação de um gatinho:
Sintaxe:
CREATE[OR REPLACE] TRIGGER "nome_trigger"
[quando] AFTER|BEFORE
[evento] INSERT|UPADTE|DELETE
ON tabela
[statement|for each row]
PL/SQL

INSERT-INSERTING
UPADTE-UPDTADING
DELETE-DELETING

(1)Exemplo de Gatinho:
CREATE TABLE PRODUTO_HIST
(
NUM_PRODUTO_HIST NUMBER(5),
ID_PRODUTO NUMBER(4),
NOM_PRODUTO VARCHAR2(30),
ID_CATEGORIA NUMBER(2),
VLR_PRODUTO_VELHO NUMBER(7,2),
VLR_PRODUTO_NOVO NUMBER(7,2),
DTA_PRODUTO_HIST DATE,
CONSTRAINT PK_PRODUTO_HIST PRIMARY KEY(NUM_PRODUTO_HIST)
);

CREATE SEQUENCE SEQ_NUM_PRODUTO_HIST
START WITH 1
INCREMENT BY 1;

CREATE OR REPLACE TRIGGER HISTORICO_PRODUTO
AFTER UPDATE ON PRODUTO
FOR EACH ROW
BEGIN
INSERT INTO PRODUTO_HIST VALUES(SEQ_NUM_PRODUTO_HIST.NEXTVAL,
:NEW.ID_PRODUTO,:NEW.NOM_PRODUTO, :NEW.ID_CATEGORIA,
:OLD.VLR_PRODUTO,:NEW.VLR_PRODUTO, SYSDATE);
END;

Testando o gatinho:
UPDATE PRODUTO SET VLR_PRODUTO=43.5 WHERE ID_PRODUTO=20;

SELECT * FROM PRODUTO;
SELECT * FROM PRODUTO_HIST;

(2)Exemplo de gatinho:
CREATE TABLE CLIENTEBKP AS SELECT * FROM CLIENTE;-Cria uma copia de CLIENTE so que sem chave primaria

CREATE OR REPLACE TRIGGER BKPCLIENTE
AFTER INSERT OR UPDATE OR DELETE
ON CLIENTE
FOR EACH ROW
BEGIN
IF INSERTING THEN
INSERT INTO CLIENTEBKP VALUES(:NEW.ID_CLIENTE,:NEW.NOM_CLIENTE,:NEW.DTN_CLIENTE,:NEW.DOC_CLIENTE);
ELSIF UPDATING THEN
UPDATE CLIENTEBKP SET ID_CLIENTE=:NEW.ID_CLIENTE, NOM_CLIENTE=:NEW.NOM_CLIENTE,
DTN_CLIENTE=:NEW.DTN_CLIENTE, DOC_CLIENTE=:NEW.DOC_CLIENTE WHERE ID_CLIENTE=:OLD.ID_CLIENTE;
ELSE 
DELETE CLIENTEBKP WHERE ID_CLIENTE=:OLD.ID_CLIENTE;
END IF;
END;

Testando o gatinho:
INSERT INTO CLIENTE VALUES(SEQ_COD_CLIENTE.NEXTVAL,'Unaerp',
'01/06/1924','00112233445518');

UPDATE CLIENTE SET DOC_CLIENTE='12345678901234' WHERE NOM_CLIENTE='Unaerp';

DELETE CLIENTE WHERE NOM_CLIENTE='Unaerp';



--DESC USER_TRIGGERS

--Listar nome dos gatinhos criados
SELECT TRIGGER_NAME FROM USER_TRIGGERS;